<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chatBot</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    
    <!-- Our Custom CSS -->
    {% load static %}
    <link href="{% static 'styles.css' %}" rel="stylesheet">

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'favicon/site.webmanifest' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'favicon/favicon.ico' %}">

    <!-- Page-specific CSS -->
    {% block extra_css %}{% endblock %}
   
</head>
<body>
    <!-- Sticky Navbar -->
   <nav class="navbar navbar-dark bg-dark sticky-navbar">
    <div class="container">
        <!-- ChatBot text/logo - NOW A LINK WHEN LOGGED IN -->
        {% if user.is_authenticated %}
            <!-- Link to chat page -->
            <a href="{% url 'home' %}" class="navbar-brand" style="cursor: pointer; text-decoration: none;">
                chatBot
            </a>
        {% else %}
            <!-- Plain text when not logged in -->
            <span class="navbar-brand">chatBot</span>
        {% endif %}
        
            {% if user.is_authenticated %}
                <div class="profile-container">
                    <!-- Horizontal Layout: Profile Picture + Username + Three Dots -->
                    <div class="nav-profile-display">
                        <!-- Profile Picture (Avatar) -->
                        <div class="nav-profile-avatar">
                            {% if user.socialaccount_set.all.0.get_avatar_url %}
                                <img src="{{ user.socialaccount_set.all.0.get_avatar_url }}" 
                                     alt="{{ user.username }}" 
                                     class="nav-avatar-image">
                            {% else %}
                                <div class="nav-avatar-initial">
                                    {{ user.username|first|upper }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Username -->
                        <div class="nav-profile-username">
                            {{ user.get_full_name|default:user.username }}
                        </div>
                        
                        <!-- Three Dots Menu Trigger (No Background Button) -->
                        <button class="nav-dots-trigger" id="profile-btn">
                            <i class="bi bi-three-dots"></i>
                        </button>
                    </div>

                    <!-- Profile Dropdown -->
                    <div class="profile-dropdown" id="profile-dropdown">
                        <div class="dropdown-header">
                            <div class="dropdown-avatar">
                                {% if user.socialaccount_set.all.0.get_avatar_url %}
                                    <img src="{{ user.socialaccount_set.all.0.get_avatar_url }}" 
                                         alt="{{ user.username }}" 
                                         class="dropdown-image">
                                {% else %}
                                    <!-- Bootstrap Person Circle Icon as Fallback -->
                                    <div class="dropdown-initial">
                                        <i class="bi bi-person-circle"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="dropdown-userinfo">
                                 <a href="{% url 'account_settings' %}">
                                <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                                <div class="user-email">{{ user.email }}</div>
                                 </a>
                            </div>
                        </div>

                        <div class="dropdown-divider"></div>

                        <!-- Settings Item with Bootstrap Gear Icon -->
                        <a href="{% url 'general_settings' %}" class="dropdown-item">
                            <i class="bi bi-gear-fill dropdown-icon me-2"></i>
                            Settings
                        </a>

                        <!-- Contact Support Item with Bootstrap Chat Icon -->
                        <a href="{% url 'contact_settings' %}" class="dropdown-item">
                            <i class="bi bi-chat-left-dots-fill dropdown-icon me-2"></i>
                            Contact
                        </a>
                        <!-- Help Item with Bootstrap Question Circle Icon -->
                        <a href="{% url 'help_center' %}" class="dropdown-item" id="help-link">
                            <i class="bi bi-question-circle-fill dropdown-icon me-2"></i>
                            Help
                        </a>

                        <div class="dropdown-divider"></div>
                        <!-- Logout Item with Bootstrap Box Arrow Right Icon -->
                        <form method="post" action="{% url 'logout' %}" class="logout-form">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-item logout-item">
                                <i class="bi bi-box-arrow-right dropdown-icon me-2"></i>
                                Logout
                            </button>
                        </form>
                    </div>
                </div>
            {% endif %}
        </div>
    </nav>
    
    <div class="container mt-4">
        {% block content %}
        {% endblock %}
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

   <!-- Global JavaScript (loaded on EVERY page) -->
    <script src="{% static 'base.js' %}"></script>
    
    <!-- Page-specific JavaScript -->
    {% block extra_js %}{% endblock %}
    
    <!-- Legacy scripts block (for backward compatibility)-->
    {% block scripts %}{% endblock %}
</body>
</html>